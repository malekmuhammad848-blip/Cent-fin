workflows:
  native-android-project:
    name: Android ZIP Project Workflow
    max_build_duration: 60
    instance_type: mac_mini_m1
    environment:
      vars:
        JAVA_VERSION: "17"
      node: "18"
    scripts:
      - name: Extract project ZIP
        script: |
          ZIP_FILE=$(find . -name "*.zip" -print -quit)
          if [ -z "$ZIP_FILE" ]; then
            echo "No ZIP file found in the repository."
            exit 1
          fi
          echo "Extracting $ZIP_FILE..."
          unzip -o "$ZIP_FILE" -d .
      - name: Go to android folder and set gradlew permissions
        script: |
          if [ ! -d "./android" ]; then
            echo "android folder not found!"
            exit 1
          fi
          cd ./android
          chmod +x ./gradlew
          # إصلاح أي مشكلة Line Endings
          sed -i 's/\r$//' ./gradlew
      - name: Install Node.js dependencies
        script: |
          if [ -f package.json ]; then
            echo "Installing npm dependencies..."
            npm install
          else
            echo "No package.json found, skipping npm install"
          fi
      - name: Sync Capacitor
        script: |
          if [ -f package.json ]; then
            echo "Running Capacitor sync..."
            npx cap sync android
          else
            echo "No Capacitor project, skipping sync"
          fi
      - name: Build Android Release APK
        script: |
          echo "Building APK..."
          ./gradlew assembleRelease
    artifacts:
      - "**/build/outputs/apk/release/*.apk"
